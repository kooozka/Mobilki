<div class="details-container" *ngIf="order">
  <div class="header">
    <h1>{{ order.title || 'Zlecenie #' + order.id }}</h1>
    <button (click)="goBack()" class="btn-back">Powr√≥t</button>
  </div>

  <div class="alert alert-error" *ngIf="errorMessage">{{ errorMessage }}</div>
  <div class="alert alert-success" *ngIf="successMessage">{{ successMessage }}</div>

  <div class="order-card">
    <div class="status-section">
      <span class="status-badge" [class]="getStatusClass(order.status)">
        {{ getStatusDisplay(order.status) }}
      </span>
      <div class="action-buttons">
        <button *ngIf="canEditOrder()" (click)="openEditDialog()" class="btn-edit">
          Modyfikuj zlecenie
        </button>
        <button *ngIf="canCancelOrder()" (click)="openCancelDialog()" class="btn-cancel">
          Anuluj zlecenie
        </button>
      </div>
    </div>

    <div class="details-grid">
      <div class="detail-section">
        <h2>üìç Miejsce odbioru</h2>
        <p><strong>Lokalizacja:</strong> {{ order.pickupLocation }}</p>
        <p><strong>Adres:</strong> {{ order.pickupAddress }}</p>
        <p><strong>Data odbioru:</strong></p>
        <p class="time-window">{{ order.pickupDate | date:'dd.MM.yyyy' }}</p>
      </div>

      <div class="detail-section">
        <h2>üìç Miejsce dostawy</h2>
        <p><strong>Lokalizacja:</strong> {{ order.deliveryLocation }}</p>
        <p><strong>Adres:</strong> {{ order.deliveryAddress }}</p>
        <p><strong>Termin dostawy:</strong></p>
        <p class="time-window">{{ order.deliveryDeadline | date:'dd.MM.yyyy' }}</p>
      </div>

      <div class="detail-section">
        <h2>üöö Informacje o transporcie</h2>
        <p><strong>Rodzaj pojazdu:</strong> {{ getVehicleTypeDisplay(order.vehicleType) }}</p>
        <p><strong>Waga ≈Çadunku:</strong> {{ order.cargoWeight }} kg</p>
        <p><strong>Opis:</strong> {{ order.description || 'Brak opisu' }}</p>
      </div>

      <div class="detail-section">
        <h2>üë§ Dane kontaktowe</h2>
        <p><strong>Klient:</strong> {{ order.clientEmail }}</p>
        <p><strong>Kierowca:</strong> {{ order.driverEmail || 'Nie przypisano' }}</p>
      </div>

      <div class="detail-section">
        <h2>üìÖ Daty</h2>
        <p><strong>Data utworzenia:</strong> {{ order.createdAt | date:'medium' }}</p>
        <p><strong>Ostatnia aktualizacja:</strong> {{ order.updatedAt | date:'medium' }}</p>
      </div>

      <div class="detail-section" *ngIf="order.cancellationReason">
        <h2>‚ùå Anulowanie</h2>
        <p><strong>Pow√≥d anulowania:</strong></p>
        <p class="cancellation-reason">{{ order.cancellationReason }}</p>
      </div>
    </div>
  </div>
</div>

<div class="modal" *ngIf="showCancelDialog">
  <div class="modal-content">
    <h2>Anulowanie zlecenia</h2>
    <p>Czy na pewno chcesz anulowaƒá to zlecenie?</p>
    
    <div class="form-group">
      <label>Pow√≥d anulowania:</label>
      <textarea [(ngModel)]="cancellationReason" rows="4" placeholder="Podaj pow√≥d anulowania..."></textarea>
    </div>

    <div class="alert alert-error" *ngIf="errorMessage">{{ errorMessage }}</div>

    <div class="modal-actions">
      <button (click)="closeCancelDialog()" class="btn-secondary">Zamknij</button>
      <button (click)="confirmCancel()" class="btn-danger">Potwierd≈∫ anulowanie</button>
    </div>
  </div>
</div>

<div class="modal" *ngIf="showEditDialog">
  <div class="modal-content modal-large">
    <h2>Modyfikacja zlecenia #{{ order?.id }}</h2>
    
    <div class="form-sections">
      <div class="form-section">
        <h3>Nazwa zlecenia</h3>
        <div class="form-group">
          <label>Nazwa / tytu≈Ç zlecenia</label>
          <input type="text" [(ngModel)]="editOrderData.title" />
        </div>
      </div>

      <div class="form-section">
        <h3>Miejsce odbioru</h3>
        <div class="form-row">
          <div class="form-group">
            <label>Lokalizacja (miasto)</label>
            <input type="text" [(ngModel)]="editOrderData.pickupLocation" />
          </div>
          <div class="form-group">
            <label>Adres</label>
            <input type="text" [(ngModel)]="editOrderData.pickupAddress" />
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label>Data odbioru</label>
            <input type="date" [(ngModel)]="editOrderData.pickupDate" />
          </div>
        </div>
      </div>

      <div class="form-section">
        <h3>Miejsce dostawy</h3>
        <div class="form-row">
          <div class="form-group">
            <label>Lokalizacja (miasto)</label>
            <input type="text" [(ngModel)]="editOrderData.deliveryLocation" />
          </div>
          <div class="form-group">
            <label>Adres</label>
            <input type="text" [(ngModel)]="editOrderData.deliveryAddress" />
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label>Termin dostawy (deadline)</label>
            <input type="date" [(ngModel)]="editOrderData.deliveryDeadline" />
          </div>
        </div>
      </div>

      <div class="form-section">
        <h3>Szczeg√≥≈Çy ≈Çadunku</h3>
        <div class="form-row">
          <div class="form-group">
            <label>Waga ≈Çadunku (kg)</label>
            <input type="number" [(ngModel)]="editOrderData.cargoWeight" min="1" max="25000" />
            <small class="hint">Maksymalna waga: 25000 kg.</small>
          </div>
        </div>
        <div class="form-group">
          <label>Opis (opcjonalny)</label>
          <textarea [(ngModel)]="editOrderData.description" rows="3"></textarea>
        </div>
      </div>
    </div>

    <div class="alert alert-error" *ngIf="errorMessage">{{ errorMessage }}</div>

    <div class="modal-actions">
      <button (click)="closeEditDialog()" class="btn-secondary">Anuluj</button>
      <button (click)="confirmEdit()" class="btn-primary">Zapisz zmiany</button>
    </div>
  </div>
</div>

<div class="loading" *ngIf="!order && !errorMessage">
  <p>≈Åadowanie szczeg√≥≈Ç√≥w zlecenia...</p>
</div>
